<script>
  $(function() {
    var twitterNames = [
      <%= @locations.select{|l1| !l1.twitter_name.blank?}.map{|l2| "'#{l2.twitter_name}'"}.join(',') -%>
    ];

    var fetchCount = 0;
    var maxFetchCount = 3;

    function recentTweetUpdate(callback) {
      setTimeout(function() {
        checkStatus(function(data) {
          $.each(data, function(i,id) {
            callback(id);
          });
          if (fetchCount < maxFetchCount) recentTweetUpdate();
        });
      }, 5000);
    }

    function checkStatus(callback) {
      fetchCount++;
      $.post("/recent_tweeters", { 'n[]': twitterNames }, function(data) {
        callback(data);
      });
    }    
  });
</script>